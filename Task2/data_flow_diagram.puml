@startuml "Data Flow Diagram - Future 2.0 Domain Architecture"

title "Data Flow Diagram - Предметно-ориентированная архитектура «Будущее 2.0»"

!define RECTANGLE class

' External entities
RECTANGLE "Врачи" as doctors {
}

RECTANGLE "Бизнес-аналитики" as analysts {
}

RECTANGLE "Клиенты" as customers {
}

RECTANGLE "Фармацевтические\nкомпании" as pharma {
}

RECTANGLE "Производители\nоборудования" as equipment {
}

' Processes (Domains)
circle "1.0\nКлиническая\nобласть" as medical_domain
circle "2.0\nОбласть ИИ" as ai_domain  
circle "3.0\nФинансовая\nобласть" as fintech_domain
circle "4.0\nАналитическая\nобласть" as analytics_domain
circle "5.0\nИнтеграционный\nуровень" as integration_layer

' Data Stores
RECTANGLE "D1\nМедицинская БД\n(PostgreSQL)" as medical_db
RECTANGLE "D2\nФинансовая БД\n(PostgreSQL)" as fintech_db  
RECTANGLE "D3\nData Lake\n(S3/HDFS)" as data_lake
RECTANGLE "D4\nData Warehouse\n(Snowflake)" as data_warehouse
RECTANGLE "D5\nOLAP Engine\n(ClickHouse)" as olap_engine
RECTANGLE "D6\nAI Data Lake\n(S3/MinIO)" as ai_data_lake
RECTANGLE "D7\nEvent Store\n(Kafka)" as event_store
RECTANGLE "D8\nLegacy DWH\n(SQL Server)" as legacy_dwh

' Data flows from external entities to processes
doctors --> medical_domain : "Медицинские данные,\nснимки, результаты"
customers --> fintech_domain : "Финансовые запросы,\nплатежи"
pharma --> integration_layer : "Данные о препаратах,\nпоставках"
equipment --> medical_domain : "Телеметрия оборудования,\nкалибровочные данные"
analysts --> analytics_domain : "Запросы на отчеты,\nпараметры аналитики"

' Inter-domain data flows
medical_domain --> ai_domain : "Обезличенные\nмедицинские данные"
ai_domain --> medical_domain : "Результаты анализа ИИ,\nрекомендации"
medical_domain --> analytics_domain : "Агрегированные\nмедицинские показатели"
fintech_domain --> analytics_domain : "Финансовые метрики,\nтранзакции"
ai_domain --> analytics_domain : "Метрики моделей,\nрезультаты обучения"

' Integration layer flows
medical_domain --> integration_layer : "События изменений\nв медицинских записях"
fintech_domain --> integration_layer : "Финансовые события,\nтранзакции"
ai_domain --> integration_layer : "События завершения\nобучения моделей"
integration_layer --> analytics_domain : "Агрегированные события\nвсех доменов"

' Data store interactions
medical_domain --> medical_db : "CRUD операции\nс медицинскими данными"
medical_db --> medical_domain : "Медицинские записи,\nистории болезней"

fintech_domain --> fintech_db : "CRUD операции\nс финансовыми данными"  
fintech_db --> fintech_domain : "Финансовая история,\nкредитные данные"

ai_domain --> ai_data_lake : "Сохранение датасетов\nдля обучения"
ai_data_lake --> ai_domain : "Исторические данные\nдля моделей"

analytics_domain --> data_lake : "Сырые данные\nвсех доменов"
data_lake --> analytics_domain : "Исторические данные\nдля анализа"

analytics_domain --> data_warehouse : "Трансформированные\nданные"
data_warehouse --> analytics_domain : "Структурированные\nданные для отчетов"

analytics_domain --> olap_engine : "Агрегированные\nданные"
olap_engine --> analytics_domain : "Быстрые аналитические\nзапросы"

integration_layer --> event_store : "Все события\nсистемы"
event_store --> integration_layer : "История событий,\nповторы событий"

' Legacy migration flows
legacy_dwh --> medical_domain : "Миграция медицинских\nданных"
legacy_dwh --> fintech_domain : "Миграция финансовых\nданных"
legacy_dwh --> analytics_domain : "Миграция исторических\nданных"

' Output flows to external entities  
analytics_domain --> analysts : "Отчеты, дашборды,\nвизуализации"
medical_domain --> doctors : "Результаты диагностики,\nрекомендации ИИ"
fintech_domain --> customers : "Финансовые услуги,\nстатусы операций"

' Internal domain flows
medical_domain --> medical_domain : "Внутренняя обработка\nмедицинских данных"
fintech_domain --> fintech_domain : "Обработка платежей,\nкредитный скоринг"
ai_domain --> ai_domain : "Обучение и валидация\nмоделей"
analytics_domain --> analytics_domain : "ETL процессы,\nагрегации данных"

@enduml